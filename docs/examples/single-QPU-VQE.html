

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Single QPU VQE experiment &mdash; Interlin-q  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Distributed Quantum Phase Estimation Algorithm" href="dist_phase.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Interlin-q
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#simulated-architecture">Simulated Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#conversion-of-monolithic-to-distributed-circuit">Conversion of monolithic to distributed circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#distributed-scheduler-and-broadcasting">Distributed Scheduler and Broadcasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#executing-the-distributed-algorithm">Executing the distributed algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/computing_host.html">Computing Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/controller_host.html">Controller Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="../objects/qubits.html">Qubits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../objects/operation.html">Operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../objects/layer.html">Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../objects/circuits.html">Circuits</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="distributed_phase.html">Distributed Quantum Phase Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dist_phase.html">Distributed Quantum Phase Estimation Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="dist_phase.html#Introduction-of-Interlin-q">Introduction of Interlin-q</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Simulated-Architechture">Simulated Architechture</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Conversion-of-monolithic-to-distributed-circuit">Conversion of monolithic to distributed circuit</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Distributed-Scheduler-and-Broadcasting">Distributed Scheduler and Broadcasting</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Executing-the-distributed-algorithm">Executing the distributed algorithm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dist_phase.html#Code-implementation">Code implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Step-1:-Import-libraries.">Step 1: Import libraries.</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Step-2:-Create-monolithic-circuit-of-Quantum-Phase-Estimation">Step 2: Create monolithic circuit of Quantum Phase Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Step-3:-Define-Standard-protocols-for-controller-and-computing-hosts.">Step 3: Define Standard protocols for controller and computing hosts.</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Step-4:-Provide-inputs">Step 4: Provide inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="dist_phase.html#Step-5:-Execute-the-distributed-algorithm-and-analyse-the-results">Step 5: Execute the distributed algorithm and analyse the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Single QPU VQE experiment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Step-1:-Import-libraries.">Step 1: Import libraries.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-2:-Decompose-the-Hamiltonian.">Step 2: Decompose the Hamiltonian.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-3:-Prepare-Circuit-for-Given-Parameters">Step 3: Prepare Circuit for Given Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Main-Blocks">Main Blocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Single-step-approach">Single-step approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Split-steps-approach">Split-steps approach</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Step-4:-Run-the-circuit-and-get-the-Expectation-Value">Step 4: Run the circuit and get the Expectation Value</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Running-for-the-single-step-approach">Running for the single-step approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Running-for-the-multi-step-approach">Running for the multi-step approach</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-qutip-to-get-the-expectation-value">Using qutip to get the expectation value</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Optimise">Optimise</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Interlin-q</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Single QPU VQE experiment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/single-QPU-VQE.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Single-QPU-VQE-experiment">
<h1>Single QPU VQE experiment<a class="headerlink" href="#Single-QPU-VQE-experiment" title="Permalink to this headline">¶</a></h1>
<p>This notebook goes through the running of a VQE algorithm using interlin-q. For simplicity, we only try out using one QPU.</p>
<div class="section" id="Step-1:-Import-libraries.">
<h2>Step 1: Import libraries.<a class="headerlink" href="#Step-1:-Import-libraries." title="Permalink to this headline">¶</a></h2>
<p>First we import all the necessary libraries. Interlin-q is build using the python framework <a class="reference external" href="https://arxiv.org/abs/2003.06397">QuNetSim</a> which is a python software framework that can be used to simulate quantum networks up to the network layer. We also need PennyLane’s chemistry library for decomposing the Hamiltonian. We would also use PennyLane for the optimiser component</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Basic Libraries</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;../../&quot;</span><span class="p">)</span>

<span class="c1"># QuNetSim Components</span>
<span class="kn">from</span> <span class="nn">qunetsim.components</span> <span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">qunetsim.objects</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">qunetsim.backends.qutip_backend</span> <span class="kn">import</span> <span class="n">QuTipBackend</span>

<span class="c1"># Interlin-q Components</span>
<span class="kn">from</span> <span class="nn">interlinq</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ControllerHost</span><span class="p">,</span> <span class="n">Constants</span><span class="p">,</span> <span class="n">Clock</span><span class="p">,</span>
<span class="n">Circuit</span><span class="p">,</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">ComputingHost</span><span class="p">,</span> <span class="n">Operation</span><span class="p">)</span>

<span class="c1"># Extra needed components</span>
<span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">GradientDescentOptimizer</span>
<span class="kn">from</span> <span class="nn">hamiltonian_decomposition</span> <span class="kn">import</span> <span class="n">decompose</span>

<span class="n">Logger</span><span class="o">.</span><span class="n">DISABLED</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Step-2:-Decompose-the-Hamiltonian.">
<h2>Step 2: Decompose the Hamiltonian.<a class="headerlink" href="#Step-2:-Decompose-the-Hamiltonian." title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">geometry</span> <span class="o">=</span> <span class="s1">&#39;h2.xyz&#39;</span>
<span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">basis_set</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;h2&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">coefficients</span><span class="p">,</span> <span class="n">observables</span><span class="p">,</span> <span class="n">qubit_num</span> <span class="o">=</span> <span class="n">decompose</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">basis_set</span><span class="p">)</span>
<span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">observables</span><span class="p">))</span>

<span class="n">terms</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(-0.04207897647782276, [(&#39;Identity&#39;, 0)]),
 (0.17771287465139946, [(&#39;PauliZ&#39;, 0)]),
 (0.1777128746513994, [(&#39;PauliZ&#39;, 1)]),
 (-0.24274280513140462, [(&#39;PauliZ&#39;, 2)]),
 (-0.24274280513140462, [(&#39;PauliZ&#39;, 3)]),
 (0.17059738328801052, [(&#39;PauliZ&#39;, 0), (&#39;PauliZ&#39;, 1)]),
 (0.04475014401535161,
  [(&#39;PauliY&#39;, 0), (&#39;PauliX&#39;, 1), (&#39;PauliX&#39;, 2), (&#39;PauliY&#39;, 3)]),
 (-0.04475014401535161,
  [(&#39;PauliY&#39;, 0), (&#39;PauliY&#39;, 1), (&#39;PauliX&#39;, 2), (&#39;PauliX&#39;, 3)]),
 (-0.04475014401535161,
  [(&#39;PauliX&#39;, 0), (&#39;PauliX&#39;, 1), (&#39;PauliY&#39;, 2), (&#39;PauliY&#39;, 3)]),
 (0.04475014401535161,
  [(&#39;PauliX&#39;, 0), (&#39;PauliY&#39;, 1), (&#39;PauliY&#39;, 2), (&#39;PauliX&#39;, 3)]),
 (0.12293305056183798, [(&#39;PauliZ&#39;, 0), (&#39;PauliZ&#39;, 2)]),
 (0.1676831945771896, [(&#39;PauliZ&#39;, 0), (&#39;PauliZ&#39;, 3)]),
 (0.1676831945771896, [(&#39;PauliZ&#39;, 1), (&#39;PauliZ&#39;, 2)]),
 (0.12293305056183798, [(&#39;PauliZ&#39;, 1), (&#39;PauliZ&#39;, 3)]),
 (0.17627640804319591, [(&#39;PauliZ&#39;, 2), (&#39;PauliZ&#39;, 3)])]
</pre></div></div>
</div>
</div>
<div class="section" id="Step-3:-Prepare-Circuit-for-Given-Parameters">
<h2>Step 3: Prepare Circuit for Given Parameters<a class="headerlink" href="#Step-3:-Prepare-Circuit-for-Given-Parameters" title="Permalink to this headline">¶</a></h2>
<p>The circuit can be prepared using two different ways: either as one circuit, or several circuits run sequentially. The former approach is simpler and generally better for the optimisation function. The latter is better for debugging and for dynamic components of a quantum circuit (i.e. circuits that have a lot of changing operations).</p>
<div class="section" id="Main-Blocks">
<h3>Main Blocks<a class="headerlink" href="#Main-Blocks" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">rotational_gate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">initialisation_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">):</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">host_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">q_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">PREPARE_QUBITS</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">],</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>
    <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="c1"># Prepare the qubits on the computing host</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">gate</span><span class="o">=</span><span class="n">Operation</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>
    <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">gate</span><span class="o">=</span><span class="n">Operation</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>
    <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Layer</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ansatz_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">host_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">q_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">])):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">,</span>
            <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span>
            <span class="n">gate</span><span class="o">=</span><span class="n">Operation</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">,</span>
            <span class="n">gate_param</span><span class="o">=</span><span class="n">rotational_gate</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>

        <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Layer</span><span class="p">(</span><span class="n">ops</span><span class="p">))</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">TWO_QUBIT</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">3</span><span class="p">]],</span>
        <span class="n">gate</span><span class="o">=</span><span class="n">Operation</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>

    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Layer</span><span class="p">([</span><span class="n">op</span><span class="p">]))</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">TWO_QUBIT</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">gate</span><span class="o">=</span><span class="n">Operation</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>

    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Layer</span><span class="p">([</span><span class="n">op</span><span class="p">]))</span>

    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">TWO_QUBIT</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">gate</span><span class="o">=</span><span class="n">Operation</span><span class="o">.</span><span class="n">CNOT</span><span class="p">,</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>

    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Layer</span><span class="p">([</span><span class="n">op</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">layers</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">measurement_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">):</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Measuring only the first qubit</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">MEASURE</span><span class="p">,</span>
        <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;q_0_0&#39;</span><span class="p">],</span>
        <span class="n">cids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;q_0_0&#39;</span><span class="p">],</span>
        <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">host_id</span><span class="p">])</span>
    <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Layer</span><span class="p">(</span><span class="n">ops</span><span class="p">))</span>

    <span class="c1"># Measuring all qubits</span>
    <span class="n">q_ids</span> <span class="o">=</span> <span class="n">q_map</span><span class="p">[</span><span class="n">host_id</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q_id</span> <span class="ow">in</span> <span class="n">q_ids</span><span class="p">:</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">Constants</span><span class="o">.</span><span class="n">MEASURE</span><span class="p">,</span>
            <span class="n">qids</span><span class="o">=</span><span class="p">[</span><span class="n">q_id</span><span class="p">],</span>
            <span class="n">cids</span><span class="o">=</span><span class="p">[</span><span class="n">q_id</span><span class="p">],</span>
            <span class="n">computing_host_ids</span><span class="o">=</span><span class="p">[</span><span class="n">computing_host_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Layer</span><span class="p">(</span><span class="n">ops</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Single-step-approach">
<h3>Single-step approach<a class="headerlink" href="#Single-step-approach" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">initialise_and_create_ansatz</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">host_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">q_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Initialise the qubits on the computing host</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initialisation_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">))</span>

    <span class="c1"># Apply the ansatz</span>
    <span class="n">layers</span> <span class="o">=</span> <span class="n">layers</span> <span class="o">+</span> <span class="n">ansatz_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span>

    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">controller_host_protocol</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Protocol for the controller host</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">monolithic_circuit</span> <span class="o">=</span> <span class="n">initialise_and_create_ansatz</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="n">host</span><span class="o">.</span><span class="n">generate_and_send_schedules</span><span class="p">(</span><span class="n">monolithic_circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">computing_host_protocol</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
    <span class="n">host</span><span class="o">.</span><span class="n">receive_schedule</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Split-steps-approach">
<h3>Split-steps approach<a class="headerlink" href="#Split-steps-approach" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">prepare_qubits</span><span class="p">(</span><span class="n">q_map</span><span class="p">):</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="p">[</span><span class="n">initialisation_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">apply_ansatz</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
    <span class="n">circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">ansatz_operations</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">parameters</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">circuit</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">controller_host_protocol_preparation</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Protocol for the controller host</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">host</span><span class="o">.</span><span class="n">generate_and_send_schedules</span><span class="p">(</span><span class="n">prepare_qubits</span><span class="p">(</span><span class="n">q_map</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">controller_host_protocol_ansatz</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Protocol for the controller host</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">host</span><span class="o">.</span><span class="n">generate_and_send_schedules</span><span class="p">(</span><span class="n">apply_ansatz</span><span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Used for the last one</span>
<span class="k">def</span> <span class="nf">computing_host_protocol</span><span class="p">(</span><span class="n">host</span><span class="p">):</span>
    <span class="n">host</span><span class="o">.</span><span class="n">receive_schedule</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Step-4:-Run-the-circuit-and-get-the-Expectation-Value">
<h2>Step 4: Run the circuit and get the Expectation Value<a class="headerlink" href="#Step-4:-Run-the-circuit-and-get-the-Expectation-Value" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">init_network</span><span class="p">():</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="n">network</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">network</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">clock</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">()</span>

    <span class="n">qutip</span> <span class="o">=</span> <span class="n">QuTipBackend</span><span class="p">()</span>

    <span class="n">controller_host</span> <span class="o">=</span> <span class="n">ControllerHost</span><span class="p">(</span>
        <span class="n">host_id</span><span class="o">=</span><span class="s2">&quot;host_1&quot;</span><span class="p">,</span>
        <span class="n">clock</span><span class="o">=</span><span class="n">clock</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="n">qutip</span>
    <span class="p">)</span>

    <span class="n">computing_hosts</span><span class="p">,</span> <span class="n">q_map</span> <span class="o">=</span> <span class="n">controller_host</span><span class="o">.</span><span class="n">create_distributed_network</span><span class="p">(</span>
        <span class="n">num_computing_hosts</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">num_qubits_per_host</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">controller_host</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">network</span><span class="o">.</span><span class="n">add_hosts</span><span class="p">([</span>
        <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">controller_host</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">clock</span><span class="p">,</span> <span class="n">controller_host</span><span class="p">,</span> <span class="n">computing_hosts</span><span class="p">,</span> <span class="n">q_map</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Running-for-the-single-step-approach">
<h3>Running for the single-step approach<a class="headerlink" href="#Running-for-the-single-step-approach" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clock</span><span class="p">,</span> <span class="n">controller_host</span><span class="p">,</span> <span class="n">computing_hosts</span><span class="p">,</span> <span class="n">q_map</span> <span class="o">=</span> <span class="n">init_network</span><span class="p">()</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">controller_host</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span>
    <span class="n">controller_host_protocol</span><span class="p">,</span>
    <span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">computing_host_protocol</span><span class="p">)</span>

<span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qu_net_sim:Host QPU_0 started processing
INFO:qu_net_sim:Host host_1 started processing
INFO:qu_net_sim:host_1 sends BROADCAST message
INFO:qu_net_sim:sending ACK:1 from QPU_0 to host_1
INFO:qu_net_sim:QPU_0 received {&#34;QPU_0&#34;: [{&#34;name&#34;: &#34;PREPARE_QUBITS&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;, &#34;q_0_1&#34;, &#34;q_0_2&#34;, &#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: null, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;X&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;X&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.935132620818695, -0.34995168750809186], [-0.0549545845743462, 0.006386824348507643]], [[0.0549545845743462, 0.006386824348507643], [0.935132620818695, 0.34995168750809186]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.879507800560643, -0.16263760408224082], [-0.4471232796357334, 0.00978832463470065]], [[0.4471232796357334, 0.00978832463470065], [0.879507800560643, 0.16263760408224082]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.8415306556123834, -0.3629895117941569], [-0.40006883103057383, 0.0031145513098929673]], [[0.40006883103057383, 0.0031145513098929673], [0.8415306556123834, 0.3629895117941569]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.9274354442890774, -0.16893973773183632], [-0.3326177226041721, -0.026235706604433237]], [[0.3326177226041721, -0.026235706604433237], [0.9274354442890774, 0.16893973773183632]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;, &#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 2}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;, &#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 3}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_3&#34;, &#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 4}]} with sequence number 0
INFO:qu_net_sim:QPU_0 sends CLASSICAL to host_1 with sequence 0
INFO:qu_net_sim:host_1 received ACK from QPU_0 with sequence number 0
INFO:qu_net_sim:QPU_0 awaits classical ACK from host_1 with sequence 0
INFO:qu_net_sim:sending ACK:1 from host_1 to QPU_0
INFO:qu_net_sim:host_1 received ACK with sequence number 0
INFO:qu_net_sim:QPU_0 received ACK from host_1 with sequence number 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This should be 7 after the first invocation.</span>
<span class="c1"># For any further invocations, it would increase by 6: 13,19, 25, etc. So is that expected behaviour?</span>
<span class="n">clock</span><span class="o">.</span><span class="n">ticks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6
</pre></div></div>
</div>
</div>
<div class="section" id="Running-for-the-multi-step-approach">
<h3>Running for the multi-step approach<a class="headerlink" href="#Running-for-the-multi-step-approach" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clock</span><span class="p">,</span> <span class="n">controller_host</span><span class="p">,</span> <span class="n">computing_hosts</span><span class="p">,</span> <span class="n">q_map</span> <span class="o">=</span> <span class="n">init_network</span><span class="p">()</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">controller_host</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span>
    <span class="n">controller_host_protocol_preparation</span><span class="p">,</span>
    <span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">computing_host_protocol</span><span class="p">)</span>

<span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qu_net_sim:Host QPU_0 started processing
INFO:qu_net_sim:Host host_1 started processing
INFO:qu_net_sim:host_1 sends BROADCAST message
INFO:qu_net_sim:sending ACK:1 from QPU_0 to host_1
INFO:qu_net_sim:QPU_0 received {&#34;QPU_0&#34;: [{&#34;name&#34;: &#34;PREPARE_QUBITS&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;, &#34;q_0_1&#34;, &#34;q_0_2&#34;, &#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: null, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;X&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;X&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}]} with sequence number 0
INFO:qu_net_sim:QPU_0 sends CLASSICAL to host_1 with sequence 0
INFO:qu_net_sim:host_1 received ACK from QPU_0 with sequence number 0
INFO:qu_net_sim:QPU_0 awaits classical ACK from host_1 with sequence 0
INFO:qu_net_sim:sending ACK:1 from host_1 to QPU_0
INFO:qu_net_sim:host_1 received ACK with sequence number 0
INFO:qu_net_sim:QPU_0 received ACK from host_1 with sequence number 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clock</span><span class="o">.</span><span class="n">ticks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t1</span> <span class="o">=</span> <span class="n">controller_host</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span>
    <span class="n">controller_host_protocol_ansatz</span><span class="p">,</span>
    <span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">computing_host_protocol</span><span class="p">)</span>

<span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qu_net_sim:host_1 sends BROADCAST message
INFO:qu_net_sim:sending ACK:2 from QPU_0 to host_1
INFO:qu_net_sim:QPU_0 received {&#34;QPU_0&#34;: [{&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.935132620818695, -0.34995168750809186], [-0.0549545845743462, 0.006386824348507643]], [[0.0549545845743462, 0.006386824348507643], [0.935132620818695, 0.34995168750809186]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 2}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.879507800560643, -0.16263760408224082], [-0.4471232796357334, 0.00978832463470065]], [[0.4471232796357334, 0.00978832463470065], [0.879507800560643, 0.16263760408224082]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 2}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.8415306556123834, -0.3629895117941569], [-0.40006883103057383, 0.0031145513098929673]], [[0.40006883103057383, 0.0031145513098929673], [0.8415306556123834, 0.3629895117941569]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 2}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.9274354442890774, -0.16893973773183632], [-0.3326177226041721, -0.026235706604433237]], [[0.3326177226041721, -0.026235706604433237], [0.9274354442890774, 0.16893973773183632]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 2}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;, &#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 3}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;, &#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 4}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_3&#34;, &#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 5}]} with sequence number 1
INFO:qu_net_sim:QPU_0 sends CLASSICAL to host_1 with sequence 1
INFO:qu_net_sim:QPU_0 awaits classical ACK from host_1 with sequence 1
INFO:qu_net_sim:host_1 received ACK from QPU_0 with sequence number 1
INFO:qu_net_sim:sending ACK:2 from host_1 to QPU_0
INFO:qu_net_sim:host_1 received ACK with sequence number 1
INFO:qu_net_sim:QPU_0 received ACK from host_1 with sequence number 1
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clock</span><span class="o">.</span><span class="n">ticks</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7
</pre></div></div>
</div>
</div>
<div class="section" id="Using-qutip-to-get-the-expectation-value">
<h3>Using qutip to get the expectation value<a class="headerlink" href="#Using-qutip-to-get-the-expectation-value" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">identity</span><span class="p">,</span> <span class="n">sigmax</span><span class="p">,</span> <span class="n">sigmay</span><span class="p">,</span> <span class="n">sigmaz</span>
<span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">expect</span>

<span class="k">def</span> <span class="nf">string_to_qutip_pauli</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;Identity&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;PauliX&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigmax</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;PauliY&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigmay</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;PauliZ&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigmaz</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">expectation_value</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">matrices</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
        <span class="n">coefficient</span><span class="p">,</span> <span class="n">observables</span> <span class="o">=</span> <span class="n">term</span>

        <span class="n">needed_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">needed_paulis</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
            <span class="n">pauli</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">obs</span>

            <span class="n">needed_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">needed_paulis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string_to_qutip_pauli</span><span class="p">(</span><span class="n">pauli</span><span class="p">))</span>

        <span class="n">expectation</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">needed_paulis</span><span class="p">,</span> <span class="n">needed_matrices</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">+=</span> <span class="n">coefficient</span> <span class="o">*</span> <span class="n">expectation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">density_matrices</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">qubit_id</span> <span class="ow">in</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qubit_ids</span><span class="p">:</span>
    <span class="n">qubit</span> <span class="o">=</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_qubit_by_id</span><span class="p">(</span><span class="n">qubit_id</span><span class="p">)</span>
    <span class="n">density_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">density_operator</span><span class="p">(</span><span class="n">qubit</span><span class="p">))</span>

<span class="n">density_matrices</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Quantum object: dims = [[2], [2]], shape = (2, 2), type = oper, isherm = True
 Qobj data =
 [[ 0.16214572+0.j         -0.04915474+0.01713544j]
  [-0.04915474-0.01713544j  0.83785428+0.j        ]],
 Quantum object: dims = [[2], [2]], shape = (2, 2), type = oper, isherm = True
 Qobj data =
 [[ 0.34145788+0.j         -0.39165646+0.04298185j]
  [-0.39165646-0.04298185j  0.65854212+0.j        ]],
 Quantum object: dims = [[2], [2]], shape = (2, 2), type = oper, isherm = True
 Qobj data =
 [[ 0.83993523+0.j         -0.020644  +0.00909593j]
  [-0.020644  -0.00909593j  0.16006477+0.j        ]],
 Quantum object: dims = [[2], [2]], shape = (2, 2), type = oper, isherm = True
 Qobj data =
 [[ 0.7642501 +0.j         -0.24510936+0.01696731j]
  [-0.24510936-0.01696731j  0.2357499 +0.j        ]]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">expectation_value</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">density_matrices</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-0.7957850305933003
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Optimise">
<h2>Optimise<a class="headerlink" href="#Optimise" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">identity</span><span class="p">,</span> <span class="n">sigmax</span><span class="p">,</span> <span class="n">sigmay</span><span class="p">,</span> <span class="n">sigmaz</span>
<span class="kn">from</span> <span class="nn">qutip</span> <span class="kn">import</span> <span class="n">expect</span>

<span class="k">def</span> <span class="nf">string_to_qutip_pauli</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;Identity&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;PauliX&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigmax</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;PauliY&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigmay</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s1">&#39;PauliZ&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sigmaz</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">expectation_value</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">matrices</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
        <span class="n">coefficient</span><span class="p">,</span> <span class="n">observables</span> <span class="o">=</span> <span class="n">term</span>

        <span class="n">needed_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">needed_paulis</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">observables</span><span class="p">:</span>
            <span class="n">pauli</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">obs</span>

            <span class="n">needed_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matrices</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="n">needed_paulis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string_to_qutip_pauli</span><span class="p">(</span><span class="n">pauli</span><span class="p">))</span>

        <span class="n">expectation</span> <span class="o">=</span> <span class="n">expect</span><span class="p">(</span><span class="n">needed_paulis</span><span class="p">,</span> <span class="n">needed_matrices</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">+=</span> <span class="n">coefficient</span> <span class="o">*</span> <span class="n">expectation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">cost_fn</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="n">network</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">network</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">clock</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">()</span>

    <span class="n">qutip</span> <span class="o">=</span> <span class="n">QuTipBackend</span><span class="p">()</span>

    <span class="n">controller_host</span> <span class="o">=</span> <span class="n">ControllerHost</span><span class="p">(</span>
        <span class="n">host_id</span><span class="o">=</span><span class="s2">&quot;host_1&quot;</span><span class="p">,</span>
        <span class="n">clock</span><span class="o">=</span><span class="n">clock</span><span class="p">,</span>
        <span class="n">backend</span><span class="o">=</span><span class="n">qutip</span>
    <span class="p">)</span>

    <span class="n">computing_hosts</span><span class="p">,</span> <span class="n">q_map</span> <span class="o">=</span> <span class="n">controller_host</span><span class="o">.</span><span class="n">create_distributed_network</span><span class="p">(</span>
        <span class="n">num_computing_hosts</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">num_qubits_per_host</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">controller_host</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">network</span><span class="o">.</span><span class="n">add_hosts</span><span class="p">([</span>
        <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">controller_host</span><span class="p">])</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="n">controller_host</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span>
    <span class="n">controller_host_protocol</span><span class="p">,</span>
    <span class="p">(</span><span class="n">q_map</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">run_protocol</span><span class="p">(</span><span class="n">computing_host_protocol</span><span class="p">)</span>

    <span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">t2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="n">density_matrices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">qubit_id</span> <span class="ow">in</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">qubit_ids</span><span class="p">:</span>
        <span class="n">qubit</span> <span class="o">=</span> <span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_qubit_by_id</span><span class="p">(</span><span class="n">qubit_id</span><span class="p">)</span>
        <span class="n">density_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">density_operator</span><span class="p">(</span><span class="n">qubit</span><span class="p">))</span>


    <span class="n">network</span><span class="o">.</span><span class="n">remove_host</span><span class="p">(</span><span class="n">computing_hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">network</span><span class="o">.</span><span class="n">remove_host</span><span class="p">(</span><span class="n">controller_host</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">expectation_value</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="n">density_matrices</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">opt</span> <span class="o">=</span> <span class="n">opt</span> <span class="o">=</span> <span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="n">stepsize</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tensor([[ 1.11797316, -3.86530105,  1.84447336],
        [-2.49246701,  4.95869687, -2.97578573],
        [-0.56524129,  1.42750818,  1.3953073 ],
        [-1.11492183, -1.9811752 ,  0.79328341]], requires_grad=True)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cost_fn</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qu_net_sim:Host QPU_0 started processing
INFO:qu_net_sim:Host host_1 started processing
INFO:qu_net_sim:host_1 sends BROADCAST message
INFO:qu_net_sim:sending ACK:1 from QPU_0 to host_1
INFO:qu_net_sim:QPU_0 received {&#34;QPU_0&#34;: [{&#34;name&#34;: &#34;PREPARE_QUBITS&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;, &#34;q_0_1&#34;, &#34;q_0_2&#34;, &#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: null, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;X&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;X&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 0}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[-0.03166728279602556, 0.3525897498727833], [0.8742146405529816, -0.3323047001289419]], [[-0.8742146405529816, -0.3323047001289419], [-0.03166728279602556, -0.3525897498727833]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.7240487217891628, -0.3125154764682361], [-0.5970209248675964, -0.14715142103816284]], [[0.5970209248675964, -0.14715142103816284], [0.7240487217891628, 0.3125154764682361]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.6917350553796867, -0.3047979267544777], [-0.36452021651009525, 0.5438068119842441]], [[0.36452021651009525, 0.5438068119842441], [0.6917350553796867, 0.3047979267544777]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;SINGLE&#34;, &#34;qids&#34;: [&#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;custom_gate&#34;, &#34;gate_param&#34;: [[[0.5411248043502964, 0.08778132718020476], [0.4836945380987444, -0.6822887794246493]], [[-0.4836945380987444, -0.6822887794246493], [0.5411248043502964, -0.08778132718020476]]], &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 1}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;, &#34;q_0_3&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 2}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_2&#34;, &#34;q_0_0&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 3}, {&#34;name&#34;: &#34;TWO_QUBIT&#34;, &#34;qids&#34;: [&#34;q_0_3&#34;, &#34;q_0_1&#34;], &#34;cids&#34;: null, &#34;gate&#34;: &#34;cnot&#34;, &#34;gate_param&#34;: null, &#34;computing_host_ids&#34;: [&#34;QPU_0&#34;], &#34;pre_allocated_qubits&#34;: false, &#34;layer_end&#34;: 4}]} with sequence number 0
INFO:qu_net_sim:QPU_0 sends CLASSICAL to host_1 with sequence 0
INFO:qu_net_sim:host_1 received ACK from QPU_0 with sequence number 0
INFO:qu_net_sim:QPU_0 awaits classical ACK from host_1 with sequence 0
INFO:qu_net_sim:sending ACK:1 from host_1 to QPU_0
INFO:qu_net_sim:host_1 received ACK with sequence number 0
INFO:qu_net_sim:QPU_0 received ACK from host_1 with sequence number 0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.03713374738267447
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Logger</span><span class="o">.</span><span class="n">DISABLED</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">rotational_gate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">omega</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">]])</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">tensor</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">_value</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">debug</span>
<span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">conv_tol</span> <span class="o">=</span> <span class="mf">1e-06</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">prev_energy</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">step_and_cost</span><span class="p">(</span><span class="n">cost_fn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">cost_fn</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">energy</span> <span class="o">-</span> <span class="n">prev_energy</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iteration = </span><span class="si">{:}</span><span class="s1">,  Energy = </span><span class="si">{:.8f}</span><span class="s1"> Ha&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">energy</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">conv</span> <span class="o">&lt;=</span> <span class="n">conv_tol</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ERROR:root:No traceback has been produced, nothing to debug.
/home/shiro-raven/.local/lib/python3.8/site-packages/autograd/tracer.py:14: UserWarning: Output seems independent of input.
  warnings.warn(&#34;Output seems independent of input.&#34;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Iteration = 0,  Energy = 0.03713375 Ha
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Stephen DiAdamo, Rhea Parekh.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>